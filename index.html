<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cathay Family Sync — The Ultimate Travel Match</title>
  
  <!-- Typography: Playfair Display (Editorial) & DM Sans (Modern UI) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Cathay Brand & Vibe Palette */
      --cx-jade: #006a5b;
      --cx-teal: #00857a;
      --cx-slate: #2d3b3b;
      --bg-cream: #fdfcf8;
      --soft-mint: #eef7f6;
      --warm-sand: #f4f1ea;
      --accent-coral: #ff8f70;
      
      /* Typography */
      --font-head: 'Playfair Display', serif;
      --font-body: 'DM Sans', sans-serif;
      
      /* Animation */
      --ease-out: cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0; padding: 0;
      font-family: var(--font-body);
      color: var(--cx-slate);
      background-color: var(--bg-cream);
      height: 100vh;
      overflow: hidden; /* Main scroll is handled inside panes */
      display: flex;
    }

    /* --- BACKGROUND ANIMATION --- */
    .blob-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; pointer-events: none; opacity: 0.5;
    }
    .blob {
      position: absolute; border-radius: 50%;
      filter: blur(80px); animation: float 25s infinite ease-in-out;
    }
    .b1 { width: 60vh; height: 60vh; background: #d0f0eb; top: -20%; left: -10%; }
    .b2 { width: 50vh; height: 50vh; background: #ffeadd; bottom: -10%; right: -10%; animation-delay: -5s; }
    .b3 { width: 30vh; height: 30vh; background: #e0f2f1; top: 40%; left: 40%; animation-delay: -10s; }
    
    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(30px, -50px) scale(1.05); }
      66% { transform: translate(-20px, 20px) scale(0.95); }
    }

    /* --- LAYOUT STRUCTURE --- */
    .split-layout { display: flex; width: 100%; height: 100%; transition: transform 0.6s var(--ease-out); }
    
    /* Left Pane: Narrative & Context */
    .pane-left {
      flex: 0 0 40%;
      padding: 5vw;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
      background: rgba(253, 252, 248, 0.8);
      z-index: 2;
    }

    /* Right Pane: Interactive Area */
    .pane-right {
      flex: 1;
      position: relative;
      overflow-y: auto;
      scroll-behavior: smooth;
      padding: 5vw;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(255,255,255,0.4);
      backdrop-filter: blur(10px);
      border-left: 1px solid rgba(0,0,0,0.04);
    }

    /* --- TYPOGRAPHY --- */
    h1 {
      font-family: var(--font-head);
      font-size: clamp(2.5rem, 5vw, 4.5rem);
      line-height: 1.1; margin: 0 0 1.5rem;
      color: var(--cx-jade);
    }
    h2 { font-family: var(--font-head); font-size: 2.2rem; margin: 0 0 1rem; color: var(--cx-slate); }
    h3 { font-family: var(--font-head); font-size: 1.5rem; margin: 0 0 0.5rem; }
    p { font-size: 1.1rem; line-height: 1.6; color: #555; max-width: 500px; margin-bottom: 2rem; }
    
    .overline {
      text-transform: uppercase; letter-spacing: 2px;
      font-size: 0.75rem; font-weight: 700; color: var(--cx-teal);
      margin-bottom: 1rem; display: block;
    }

    /* --- UI COMPONENTS --- */
    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 16px 36px; background: var(--cx-slate); color: #fff;
      border: none; border-radius: 50px; font-weight: 700; font-size: 1rem;
      cursor: pointer; transition: all 0.2s ease; text-decoration: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); background: var(--cx-jade); }
    .btn-outline { background: transparent; border: 2px solid var(--cx-slate); color: var(--cx-slate); box-shadow:none; }
    .btn-outline:hover { background: var(--cx-slate); color: #fff; }

    /* Destination Cards */
    .grid-dest { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; width: 100%; max-width: 800px; }
    .card-dest {
      background: #fff; border-radius: 16px; overflow: hidden;
      cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 2px solid transparent; text-align: left;
    }
    .card-dest:hover { transform: translateY(-5px); box-shadow: 0 12px 30px rgba(0,0,0,0.08); }
    .card-dest.selected { border-color: var(--cx-jade); background: var(--soft-mint); }
    .dest-img-box { height: 140px; width: 100%; background: #eee; position: relative; }
    /* CSS Gradients for Destination Placeholders */
    .g-tokyo { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
    .g-london { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
    .g-paris { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
    .g-bangkok { background: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%); }
    .g-nyc { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); }
    .g-rome { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .g-sydney { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .g-cape { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    .dest-info { padding: 1.2rem; }

    /* Role Cards */
    .grid-roles { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width: 100%; max-width: 500px; }
    .card-role {
      background: #fff; padding: 2rem; border-radius: 16px; text-align: center; cursor: pointer;
      border: 1px solid rgba(0,0,0,0.05); transition: all 0.3s ease;
    }
    .card-role:hover { border-color: var(--cx-jade); transform: translateY(-4px); box-shadow: 0 12px 25px rgba(0,106,91,0.1); }

    /* Quiz Question */
    .quiz-container { width: 100%; max-width: 650px; }
    .quiz-opt {
      background: #fff; padding: 1.5rem; margin-bottom: 1rem; border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.08); cursor: pointer; display: flex; align-items: center; gap: 1rem;
      transition: all 0.2s ease;
    }
    .quiz-opt:hover { border-color: var(--cx-jade); background: var(--soft-mint); transform: translateX(5px); }
    .dot { width: 18px; height: 18px; border-radius: 50%; border: 2px solid #ccc; flex-shrink: 0; }
    .quiz-opt:hover .dot { border-color: var(--cx-jade); background: var(--cx-jade); }

    /* Results */
    .result-split { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; width: 100%; margin: 2rem 0; }
    .res-card { 
      background: #fff; padding: 0; border-radius: 16px; overflow: hidden; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.05); display: flex; flex-direction: column; 
    }
    .res-img { 
      height: 500px; /* Increased height to fit full poster image */
      width: 100%; 
      background: #fff; 
      object-fit: contain; /* Ensures the whole image is seen */
    }
    .res-content { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; justify-content: center; }
    .res-tag { display: inline-block; font-size: 0.75rem; font-weight: 700; color: #fff; background: var(--cx-jade); padding: 4px 10px; border-radius: 20px; margin-bottom: 0.5rem; }
    
    .timeline { position: relative; margin-top: 2rem; padding-left: 1.5rem; border-left: 2px solid #ddd; }
    .t-item { position: relative; margin-bottom: 2rem; }
    .t-dot { position: absolute; left: -1.95rem; top: 0.2rem; width: 12px; height: 12px; background: var(--cx-jade); border-radius: 50%; border: 4px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .t-time { font-size: 0.85rem; font-weight: 700; color: #999; text-transform: uppercase; }
    .t-title { font-size: 1.1rem; font-weight: 700; margin: 0.3rem 0; }
    .t-badge { display: inline-block; font-size: 0.7rem; background: var(--soft-mint); color: var(--cx-jade); padding: 2px 8px; border-radius: 4px; margin-bottom: 6px; font-weight: 600; }

    /* UTILS */
    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.6s ease forwards; opacity: 0; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    /* MOBILE */
    @media (max-width: 900px) {
      body { display: block; overflow: auto; height: auto; }
      .split-layout { flex-direction: column; }
      .pane-left { min-height: 40vh; padding: 3rem 1.5rem; text-align: center; align-items: center; }
      .pane-right { padding: 2rem 1.5rem; min-height: 60vh; }
      h1 { font-size: 2.8rem; }
      .result-split { grid-template-columns: 1fr; }
      .grid-roles { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <div class="blob-canvas">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <div class="split-layout">
    
    <!-- LEFT PANE: NARRATIVE -->
    <div class="pane-left" id="leftPane">
      <div class="fade-in">
        <span class="overline">Cathay Family Sync</span>
        <h1 id="mainTitle">Sync your styles,<br>design the day.</h1>
        <p id="mainDesc">
          A travel experience builder for two. Pick a destination, discover your unique travel personas, and get a tailored itinerary that keeps everyone happy.
        </p>
        <div id="visualPlaceholder" style="width: 100%; height: 250px; background: radial-gradient(circle at 30% 30%, #e0f2f1, transparent 60%); border-radius: 50%; margin-top: 1rem; opacity: 0.8;"></div>
      </div>
    </div>

    <!-- RIGHT PANE: INTERACTIVE STEPS -->
    <div class="pane-right" id="rightPane">

      <!-- STEP 0: INTRO BUTTON -->
      <div id="stepIntro" class="fade-in" style="text-align: center;">
        <button class="btn" onclick="goToDestinations()">Start the Experience</button>
      </div>

      <!-- STEP 1: DESTINATION -->
      <div id="stepDest" class="hidden" style="width: 100%; max-width: 800px;">
        <div style="text-align:center; margin-bottom: 2rem;">
          <span class="overline">Step 1 of 4</span>
          <h2>Where are we going?</h2>
        </div>
        <div class="grid-dest">
          <div class="card-dest" onclick="selectDest('tokyo')"><div class="dest-img-box g-tokyo"></div><div class="dest-info"><h3>Tokyo</h3><p style="margin:0;font-size:0.85rem">Neon & Tradition</p></div></div>
          <div class="card-dest" onclick="selectDest('london')"><div class="dest-img-box g-london"></div><div class="dest-info"><h3>London</h3><p style="margin:0;font-size:0.85rem">History & Cozy</p></div></div>
          <div class="card-dest" onclick="selectDest('paris')"><div class="dest-img-box g-paris"></div><div class="dest-info"><h3>Paris</h3><p style="margin:0;font-size:0.85rem">Art & Romance</p></div></div>
          <div class="card-dest" onclick="selectDest('bangkok')"><div class="dest-img-box g-bangkok"></div><div class="dest-info"><h3>Bangkok</h3><p style="margin:0;font-size:0.85rem">Chaos & Flavor</p></div></div>
          <div class="card-dest" onclick="selectDest('nyc')"><div class="dest-img-box g-nyc"></div><div class="dest-info"><h3>New York</h3><p style="margin:0;font-size:0.85rem">Energy & Icons</p></div></div>
          <div class="card-dest" onclick="selectDest('rome')"><div class="dest-img-box g-rome"></div><div class="dest-info"><h3>Rome</h3><p style="margin:0;font-size:0.85rem">Ruins & Pasta</p></div></div>
          <div class="card-dest" onclick="selectDest('sydney')"><div class="dest-img-box g-sydney"></div><div class="dest-info"><h3>Sydney</h3><p style="margin:0;font-size:0.85rem">Sun & Surf</p></div></div>
          <div class="card-dest" onclick="selectDest('capetown')"><div class="dest-img-box g-cape"></div><div class="dest-info"><h3>Cape Town</h3><p style="margin:0;font-size:0.85rem">Vistas & Adventure</p></div></div>
        </div>
      </div>

      <!-- STEP 2: ROLE SELECTION (Generic for both users) -->
      <div id="stepRole" class="hidden" style="text-align:center;">
        <span class="overline" id="roleStepLabel">Step 2: Traveller 1</span>
        <h2 id="roleTitle">Who is taking the quiz?</h2>
        <div class="grid-roles" style="margin: 0 auto;">
          <div class="card-role" onclick="confirmRole('Dad')"><h3>Dad</h3></div>
          <div class="card-role" onclick="confirmRole('Mom')"><h3>Mom</h3></div>
          <div class="card-role" onclick="confirmRole('Daughter')"><h3>Daughter</h3></div>
          <div class="card-role" onclick="confirmRole('Son')"><h3>Son</h3></div>
        </div>
      </div>

      <!-- STEP 3: QUIZ -->
      <div id="stepQuiz" class="hidden quiz-container">
        <span class="overline" id="quizProgress">Question 1 / 8</span>
        <h2 id="quizQuestion" style="font-size: 1.8rem; margin-bottom: 2rem;">...</h2>
        <div id="quizOptions"></div>
      </div>

      <!-- INTERMISSION -->
      <div id="stepIntermission" class="hidden" style="text-align: center;">
        <div style="width: 80px; height: 80px; background: var(--cx-jade); border-radius: 50%; margin: 0 auto 1.5rem; display:grid; place-items:center; color:white; font-size: 2rem;">✓</div>
        <h2>Traveller 1 Complete!</h2>
        <p>Please pass the device to Traveller 2.</p>
        <button class="btn" onclick="startSecondUser()">Continue</button>
      </div>

      <!-- FINAL RESULT -->
      <div id="stepResult" class="hidden" style="width: 100%; max-width: 900px;">
        <div style="text-align:center;">
          <span class="overline">The Conclusion</span>
          <h1 style="margin-bottom: 0.5rem;" id="resMainTitle">The Sync</h1>
          <p id="resMainDesc">Your combined travel style.</p>
        </div>

        <div class="result-split">
          <!-- Person 1 -->
          <div class="res-card">
            <!-- Uses object-fit: contain with height 500px to ensure full image visibility -->
            <img id="p1Img" class="res-img" src="" alt="Persona Image" />
            <div class="res-content">
              <span class="overline" id="p1Tag">Dad</span>
              <h3 id="p1Type" style="color:var(--cx-jade)">...</h3>
              <p style="font-size: 0.9rem; margin:0; line-height:1.5;" id="p1Desc">...</p>
            </div>
          </div>
          <!-- Person 2 -->
          <div class="res-card">
            <img id="p2Img" class="res-img" src="" alt="Persona Image" />
            <div class="res-content">
              <span class="overline" id="p2Tag">Daughter</span>
              <h3 id="p2Type" style="color:var(--cx-jade)">...</h3>
              <p style="font-size: 0.9rem; margin:0; line-height:1.5;" id="p2Desc">...</p>
            </div>
          </div>
        </div>

        <div style="background: #fff; padding: 2rem; border-radius: 16px; border: 1px solid #eee;">
          <h2 style="text-align:center;">Your <span id="planCityName">Tokyo</span> Day Plan</h2>
          <p style="text-align:center; font-size:0.9rem; margin-top:-10px;">Curated for your specific personas.</p>
          
          <div class="timeline" id="planTimeline">
            <!-- Items injected by JS -->
          </div>
        </div>

        <div style="text-align:center; margin-top: 2rem; display: flex; gap: 10px; justify-content: center;">
          <button class="btn" onclick="location.reload()">Start Over</button>
          <button class="btn btn-outline" onclick="alert('Itinerary copied!')">Share Itinerary</button>
        </div>
      </div>

    </div>
  </div>

<script>
  /* --- EXTENSIVE DATA SET (8 Questions per Role + Destinations) --- */
  const DESTINATIONS = {
    tokyo: { name: "Tokyo", spots: { history: "Senso-ji Temple & Asakusa", view: "Shibuya Sky Deck", shop: "Omotesando Hills", food: "Tsukiji Outer Market", wellness: "Meiji Jingu Forest", art: "TeamLab Planets", thrill: "Go-Karting in Akihabara" } },
    london: { name: "London", spots: { history: "Tower of London", view: "The Shard", shop: "Liberty London", food: "Borough Market", wellness: "Hyde Park Serpentine", art: "Tate Modern", thrill: "Speedboat on Thames" } },
    paris: { name: "Paris", spots: { history: "The Louvre", view: "Montparnasse Tower", shop: "Le Marais Boutiques", food: "Rue Cler Market", wellness: "Luxembourg Gardens", art: "Musée d'Orsay", thrill: "Catacombs Tour" } },
    bangkok: { name: "Bangkok", spots: { history: "The Grand Palace", view: "Wat Arun at Sunset", shop: "IconSiam", food: "Chinatown Street Food", wellness: "Wat Pho Massage", art: "Jim Thompson House", thrill: "Tuk-Tuk Race" } },
    nyc: { name: "New York", spots: { history: "Ellis Island", view: "Summit One Vanderbilt", shop: "SoHo Cast Iron District", food: "Chelsea Market", wellness: "Central Park Sheep Meadow", art: "MoMA", thrill: "Helicopter Tour" } },
    rome: { name: "Rome", spots: { history: "The Colosseum", view: "Gianicolo Hill", shop: "Via del Corso", food: "Testaccio Market", wellness: "Villa Borghese", art: "Vatican Museums", thrill: "Vespa City Tour" } },
    sydney: { name: "Sydney", spots: { history: "The Rocks Walking Tour", view: "Sydney Harbour Bridge", shop: "Queen Victoria Building", food: "Sydney Fish Market", wellness: "Bondi to Coogee Walk", art: "Opera House Tour", thrill: "Bridge Climb" } },
    capetown: { name: "Cape Town", spots: { history: "Robben Island", view: "Table Mountain Cableway", shop: "V&A Waterfront", food: "The Old Biscuit Mill", wellness: "Kirstenbosch Gardens", art: "Zeitz MOCAA", thrill: "Paragliding Signal Hill" } }
  };

  const ROLES = {
  Dad: {
    types: {
      "Photo-Op": { 
        title: "The Photo-Op Dad", 
        img: "assets/The Photo-Op Dad.png", 
        desc: "Insists on getting the perfect family photo at every landmark.", 
        tag: "view", 
        planText: "Golden Hour Photography at [SPOT]" 
      },
      "Friendly Fellow": { 
        title: "The Friendly Fellow Dad", 
        img: "assets/The Friendly Fellow Dad.png", 
        desc: "Chats with strangers and makes friends with everyone he meets.", 
        tag: "history", 
        planText: "Social mixing & local chatting at [SPOT]" 
      },
      "Scenic Shortcut": { 
        title: "The Scenic Shortcut Dad", 
        img: "assets/The Scenic Shortcut Dad.png", 
        desc: "Wants great views without long walks.", 
        tag: "view", 
        planText: "Relaxed Scenic View at [SPOT] (Access via Lift/Cab)" 
      },
      "Budget Boss": { 
        title: "The Budget Boss Dad", 
        img: "assets/The Budget Boss Dad.png", 
        desc: "Tracks every expense and finds the best deals.", 
        tag: "food", 
        planText: "Value-for-Money Local Eats at [SPOT]" 
      }
    },
    questions: [
        { q: "We need a place for dinner. You choose...", opts: [{t:"A rooftop bar with a skyline view.",p:"Photo-Op"}, {t:"A communal table at a lively beer hall.",p:"Friendly Fellow"}, {t:"The hotel restaurant (zero walking).",p:"Scenic Shortcut"}, {t:"The place with the 'Kids Eat Free' sign.",p:"Budget Boss"}] },
        { q: "You have 2 free hours in the city. You go to...", opts: [{t:"The highest observation deck available.",p:"Photo-Op"}, {t:"The town square to people watch.",p:"Friendly Fellow"}, {t:"A river cruise (sitting down).",p:"Scenic Shortcut"}, {t:"The public market for cheap snacks.",p:"Budget Boss"}] },
        { q: "The family is complaining about walking. You say:", opts: [{t:"Just one more block for the perfect light!",p:"Photo-Op"}, {t:"I'll ask this nice local for a shortcut!",p:"Friendly Fellow"}, {t:"Agreed. Let's hail a cab right now.",p:"Scenic Shortcut"}, {t:"Walking is free! We save $20!",p:"Budget Boss"}] },
        { q: "Which phrase do you use most on a trip?", opts: [{t:"'Everyone squeeze in together!'",p:"Photo-Op"}, {t:"'Where are you folks visiting from?'",p:"Friendly Fellow"}, {t:"'Is there an elevator?'",p:"Scenic Shortcut"}, {t:"'Is service charge included?'",p:"Budget Boss"}] },
        { q: "Your ideal souvenir is...", opts: [{t:"A framed professional family portrait.",p:"Photo-Op"}, {t:"A gift a local recommended to you.",p:"Friendly Fellow"}, {t:"A high-quality travel pillow.",p:"Scenic Shortcut"}, {t:"Something from the clearance bin.",p:"Budget Boss"}] },
        { q: "We are lost. You...", opts: [{t:"Take photos of landmarks to retrace steps.",p:"Photo-Op"}, {t:"Immediately ask a stranger for help.",p:"Friendly Fellow"}, {t:"Sit on a bench until we figure it out.",p:"Scenic Shortcut"}, {t:"Refuse to turn on data roaming to check maps.",p:"Budget Boss"}] },
        { q: "The ultimate travel nightmare is...", opts: [{t:"Rainy, gray, flat lighting.",p:"Photo-Op"}, {t:"A city with no friendly locals.",p:"Friendly Fellow"}, {t:"A 'scenic' hike that is all uphill.",p:"Scenic Shortcut"}, {t:"Paying full price for water.",p:"Budget Boss"}] },
        { q: "You feel most successful when...", opts: [{t:"You capture the shot of the trip.",p:"Photo-Op"}, {t:"You make a new friend.",p:"Friendly Fellow"}, {t:"You didn't break a sweat all day.",p:"Scenic Shortcut"}, {t:"You came in under budget.",p:"Budget Boss"}] }
    ]
  },
  Mom: {
    types: {
      "One-Stop Lounger": { 
        title: "The One-Stop Lounger Mom", 
        img: "assets/The One-Stop Lounger Mom.png", 
        desc: "Always needs a long break at a café after every stop.", 
        tag: "wellness", 
        planText: "Extended Coffee & Chill Break at [SPOT]" 
      },
      "Shopping Strategist": { 
        title: "The Shopping Strategist Mom", 
        img: "assets/The Shopping Strategist Mom.png", 
        desc: "Prioritising shopping experiences.", 
        tag: "shop", 
        planText: "Curated Boutique Sweep at [SPOT]" 
      },
      "Memory Maker": { 
        title: "The Memory Maker Mom", 
        img: "assets/The Memory Maker Mom.png", 
        desc: "Snaps photos and curates family albums.", 
        tag: "view", 
        planText: "Nostalgic Photo Session at [SPOT]" 
      },
      "Safety-First": { 
        title: "The Safety-First Mom", 
        img: "assets/The Safety-First Mom.png", 
        desc: "Always prepared with first-aid kits and checks safety at every stop.", 
        tag: "wellness", 
        planText: "Safe & Relaxed Exploration at [SPOT]" 
      }
    },
    questions: [
        { q: "Lunch time. Your priority is...", opts: [{t:"Comfortable seating and AC.",p:"One-Stop Lounger"}, {t:"Near the main shopping street.",p:"Shopping Strategist"}, {t:"A place with a cute aesthetic.",p:"Memory Maker"}, {t:"Hygiene rating and food safety.",p:"Safety-First"}] },
        { q: "We arrive at the hotel. You first check...", opts: [{t:"The spa menu and pool hours.",p:"One-Stop Lounger"}, {t:"The closet space for new purchases.",p:"Shopping Strategist"}, {t:"The view for a family selfie.",p:"Memory Maker"}, {t:" The fire escape map and door locks.",p:"Safety-First"}] },
        { q: "It starts raining. You suggest...", opts: [{t:"Nap time at the hotel.",p:"One-Stop Lounger"}, {t:"Department store browsing.",p:"Shopping Strategist"}, {t:"Scrapbooking our tickets in a cafe.",p:"Memory Maker"}, {t:"Returning to hotel (slippery streets!).",p:"Safety-First"}] },
        { q: "Your suitcase is mostly full of...", opts: [{t:"Loungewear and slippers.",p:"One-Stop Lounger"}, {t:"Empty space for what I'll buy.",p:"Shopping Strategist"}, {t:"Matching outfits for the kids.",p:"Memory Maker"}, {t:"First-aid, sanitizers, and medicines.",p:"Safety-First"}] },
        { q: "A perfect morning looks like...", opts: [{t:"Room service and silence.",p:"One-Stop Lounger"}, {t:"Being first in line at the outlet.",p:"Shopping Strategist"}, {t:"Golden hour family walk.",p:"Memory Maker"}, {t:"Applying sunscreen and checking route safety.",p:"Safety-First"}] },
        { q: "You are most stressed when...", opts: [{t:"The schedule is too packed.",p:"One-Stop Lounger"}, {t:"The shops close early.",p:"Shopping Strategist"}, {t:"The kids won't smile for the photo.",p:"Memory Maker"}, {t:"We are in a crowded, chaotic place.",p:"Safety-First"}] },
        { q: "Your treat for yourself is...", opts: [{t:"A 90-minute massage.",p:"One-Stop Lounger"}, {t:"A designer handbag.",p:"Shopping Strategist"}, {t:"A professional family photoshoot.",p:"Memory Maker"}, {t:"Premium travel insurance.",p:"Safety-First"}] },
        { q: "At the airport, you are...", opts: [{t:"Asleep in the lounge.",p:"One-Stop Lounger"}, {t:"In the Duty-Free perfume aisle.",p:"Shopping Strategist"}, {t:"Taking photos of the plane.",p:"Memory Maker"}, {t:"Double-checking passports every 5 mins.",p:"Safety-First"}] }
    ]
  },
  Daughter: {
    types: {
      "Hidden Gem Hunter": { 
        title: "The Hidden Gem Hunter Daughter", 
        img: "assets/The Hidden Gem Hunter Daughter.png", 
        desc: "Loves discovering authentic local spots and unique experiences.", 
        tag: "art", 
        planText: "Off-the-beaten-path discovery at [SPOT]" 
      },
      "Insta Explorer": { 
        title: "The Insta Explorer Daughter", 
        img: "assets/The Insta Explorer Daughter.png", 
        desc: "Hunts for Instagram-worthy spots and aesthetic cafés.", 
        tag: "view", 
        planText: "Viral aesthetic photoshoot at [SPOT]" 
      },
      "Style Seeker": { 
        title: "The Style Seeker Daughter", 
        img: "assets/The Style Seeker Daughter.png", 
        desc: "Shops for trendy clothes and accessories.", 
        tag: "shop", 
        planText: "Trend-spotting & Shopping at [SPOT]" 
      },
      "Zen Enthusiast": { 
        title: "The Zen Enthusiast Daughter", 
        img: "assets/The Zen Enthusiast Daughter.png", 
        desc: "Prefers wellness activities like spas and yoga.", 
        tag: "wellness", 
        planText: "Mindfulness & Green Juice at [SPOT]" 
      }
    },
    questions: [
        { q: "We need a snack. You pick...", opts: [{t:"A hole-in-the-wall dumpling shop.",p:"Hidden Gem Hunter"}, {t:"The pink café with the flower wall.",p:"Insta Explorer"}, {t:"A trendy juice bar.",p:"Style Seeker"}, {t:"An organic acai bowl place.",p:"Zen Enthusiast"}] },
        { q: "You refuse to go to a place if...", opts: [{t:"It's a total tourist trap.",p:"Hidden Gem Hunter"}, {t:"The lighting is unflattering.",p:"Insta Explorer"}, {t:"People there dress poorly.",p:"Style Seeker"}, {t:"It's too loud and chaotic.",p:"Zen Enthusiast"}] },
        { q: "How do you choose where to go?", opts: [{t:"Reddit threads and local forums.",p:"Hidden Gem Hunter"}, {t:"TikTok and Instagram Reels.",p:"Insta Explorer"}, {t:"Vogue and fashion blogs.",p:"Style Seeker"}, {t:"Wellness retreat reviews.",p:"Zen Enthusiast"}] },
        { q: "Your outfit for the day is...", opts: [{t:"Thrifted, vintage, practical.",p:"Hidden Gem Hunter"}, {t:"Color-coordinated with the location.",p:"Insta Explorer"}, {t:"Latest season, runway ready.",p:"Style Seeker"}, {t:"Premium athleisure / Lululemon.",p:"Zen Enthusiast"}] },
        { q: "Ideal afternoon activity?", opts: [{t:"Exploring a basement art gallery.",p:"Hidden Gem Hunter"}, {t:"Picnic with aesthetic props.",p:"Insta Explorer"}, {t:"Hunting for vintage jewelry.",p:"Style Seeker"}, {t:"Sunrise yoga by the river.",p:"Zen Enthusiast"}] },
        { q: "Transportation preference?", opts: [{t:"Local bus to see the real city.",p:"Hidden Gem Hunter"}, {t:"Uber (wind ruins hair).",p:"Insta Explorer"}, {t:"Walking (to be seen).",p:"Style Seeker"}, {t:"Bike rental or walking.",p:"Zen Enthusiast"}] },
        { q: "Souvenir of choice?", opts: [{t:"Vinyl record or local zine.",p:"Hidden Gem Hunter"}, {t:"Postcards for my bedroom wall.",p:"Insta Explorer"}, {t:"A unique accessory.",p:"Style Seeker"}, {t:"Essential oils or incense.",p:"Zen Enthusiast"}] },
        { q: "Hotel requirement?", opts: [{t:"Cool, gritty neighborhood.",p:"Hidden Gem Hunter"}, {t:"Full-length selfie mirror.",p:"Insta Explorer"}, {t:"Good closet space.",p:"Style Seeker"}, {t:"Deep soaking bathtub.",p:"Zen Enthusiast"}] }
    ]
  },
  Son: {
    types: {
      "Foodie Finder": { 
        title: "The Foodie Finder Son", 
        img: "assets/The Foodie Finder Son.png", 
        desc: "Plans trips around must-try local dishes and street food.", 
        tag: "food", 
        planText: "Street Food Crawl at [SPOT]" 
      },
      "Adventure Ace": { 
        title: "The Adventure Ace Son", 
        img: "assets/The Adventure Ace Son.png", 
        desc: "Thrives on outdoor activities and adrenaline experiences.", 
        tag: "thrill", 
        planText: "Adrenaline Activity at [SPOT]" 
      },
      "Tech Tracker": { 
        title: "The Tech Tracker Son", 
        img: "assets/The Tech Tracker Son.png", 
        desc: "Uses apps to find hidden gems and navigate easily.", 
        tag: "history", 
        planText: "Augmented Reality / Tech Museum at [SPOT]" 
      },
      "Gamer-on-the-Go": { 
        title: "The Gamer-on-the-Go Son", 
        img: "assets/The Gamer-on-the-Go Son.png", 
        desc: "Finds gaming cafés or portable entertainment during downtime.", 
        tag: "art", 
        planText: "Interactive/Arcade Experience at [SPOT]" 
      }
    },
    questions: [
        { q: "It's your choice for dinner. You steer the family towards...", opts: [{t:"A hidden alleyway noodle shop with a 4.8 rating.",p:"Foodie Finder"}, {t:"A place near the park so we can run around after.",p:"Adventure Ace"}, {t:"A fully automated sushi belt place.",p:"Tech Tracker"}, {t:"A themed cafe with VR experiences.",p:"Gamer-on-the-Go"}] },
        { q: "We are navigating a complex subway system. You...", opts: [{t:"Look for the station snacks while parents figure it out.",p:"Foodie Finder"}, {t:"Suggest we walk or bike instead.",p:"Adventure Ace"}, {t:"Use an AR navigation app to lead the way.",p:"Tech Tracker"}, {t:"Play a game until we arrive at the stop.",p:"Gamer-on-the-Go"}] },
        { q: "We have an hour before the flight. You...", opts: [{t:"Find the last great meal at the terminal.",p:"Foodie Finder"}, {t:"Explore every terminal wing on foot.",p:"Adventure Ace"}, {t:"Organize your digital photo library/footage.",p:"Tech Tracker"}, {t:"Challenge dad to a mobile game match.",p:"Gamer-on-the-Go"}] },
        { q: "The hotel is cool because...", opts: [{t:"It's right above a famous night market.",p:"Foodie Finder"}, {t:"It has a climbing wall in the lobby.",p:"Adventure Ace"}, {t:"It has smart home voice controls.",p:"Tech Tracker"}, {t:"It has ultra-fast gigabit Wi-Fi.",p:"Gamer-on-the-Go"}] },
        { q: "Pick a morning activity.", opts: [{t:"Street food breakfast tour.",p:"Foodie Finder"}, {t:"Urban kayaking or hiking.",p:"Adventure Ace"}, {t:"Visiting a flagship electronics store.",p:"Tech Tracker"}, {t:"Visiting a famous arcade or comic shop.",p:"Gamer-on-the-Go"}] },
        { q: "You get annoyed when...", opts: [{t:"The food is overpriced and inauthentic.",p:"Foodie Finder"}, {t:"We spend too much time sitting on a bus.",p:"Adventure Ace"}, {t:"Google Maps isn't loading accurately.",p:"Tech Tracker"}, {t:"My console runs out of battery.",p:"Gamer-on-the-Go"}] },
        { q: "You're buying something to take home.", opts: [{t:"Local spices or snacks.",p:"Foodie Finder"}, {t:"Action cam footage of my trip.",p:"Adventure Ace"}, {t:"The latest gadget not available at home.",p:"Tech Tracker"}, {t:"A rare game or collectible figure.",p:"Gamer-on-the-Go"}] },
        { q: "You found a cool spot. It is...", opts: [{t:"A legendary food stall.",p:"Foodie Finder"}, {t:"A rooftop with a crazy view (climbed stairs).",p:"Adventure Ace"}, {t:"A fully automated convenience store.",p:"Tech Tracker"}, {t:"A cafe with retro consoles.",p:"Gamer-on-the-Go"}] }
    ]
  }
};

  /* STATE */
  let state = { destination: null, user1: { role: null, answers: [] }, user2: { role: null, answers: [] }, currentUser: 1, currentQ: 0 };
  const el = id => document.getElementById(id);
  const show = id => el(id).classList.remove('hidden');
  const hide = id => el(id).classList.add('hidden');
  const fade = id => el(id).classList.add('fade-in');

  function goToDestinations() {
    hide('stepIntro'); show('stepDest'); fade('stepDest');
    el('mainTitle').innerHTML = "First, pick<br>your backdrop.";
    el('mainDesc').innerHTML = "Every city has a different rhythm. Choose where you are headed.";
  }

  function selectDest(cityKey) {
    state.destination = cityKey;
    document.querySelectorAll('.card-dest').forEach(c => c.classList.remove('selected'));
    // Visual feedback could go here
    setTimeout(() => {
      hide('stepDest'); show('stepRole'); fade('stepRole');
      el('mainTitle').innerHTML = "Traveller 1,<br>Identify yourself.";
      el('mainDesc').innerHTML = "Are you leading the charge or following along?";
    }, 300);
  }

  function confirmRole(role) {
    if (state.currentUser === 1) state.user1.role = role; else state.user2.role = role;
    startQuiz(role);
  }

  function startQuiz(role) {
    hide('stepRole'); show('stepQuiz');
    state.currentQ = 0;
    renderQuestion();
    el('mainTitle').innerHTML = "The<br>Discovery.";
    el('mainDesc').innerHTML = `Digging into the travel psyche of the ${role}.`;
  }

  function renderQuestion() {
    const role = state.currentUser === 1 ? state.user1.role : state.user2.role;
    const qData = ROLES[role].questions[state.currentQ];
    el('quizProgress').textContent = `Traveller ${state.currentUser} • Question ${state.currentQ + 1} / 8`;
    el('quizQuestion').textContent = qData.q;
    const box = el('quizOptions'); box.innerHTML = '';
    qData.opts.forEach((o, i) => {
      const d = document.createElement('div'); d.className = 'quiz-opt fade-in'; d.style.animationDelay = (i * 0.05) + 's';
      d.onclick = () => handleAnswer(o.p);
      d.innerHTML = `<div class="dot"></div><div>${o.t}</div>`;
      box.appendChild(d);
    });
  }

  function handleAnswer(type) {
    if (state.currentUser === 1) state.user1.answers.push(type); else state.user2.answers.push(type);
    if (state.currentQ < 7) { state.currentQ++; renderQuestion(); } else { finishUser(); }
  }

  function finishUser() {
    hide('stepQuiz');
    if (state.currentUser === 1) {
      state.currentUser = 2; show('stepIntermission'); fade('stepIntermission');
      el('mainTitle').innerHTML = "Halfway<br>There."; el('mainDesc').innerHTML = "Hand the device over to the second traveller.";
    } else {
      calculateResult();
    }
  }

  function startSecondUser() {
    hide('stepIntermission'); show('stepRole'); fade('stepRole');
    el('roleStepLabel').textContent = "Step 3: Traveller 2";
    el('mainTitle').innerHTML = "Traveller 2,<br>Your turn."; el('mainDesc').innerHTML = "Let's see how your style compares.";
  }

  function calculateResult() {
    const getWinner = (arr) => { const t={}; arr.forEach(a=>t[a]=(t[a]||0)+1); return Object.keys(t).reduce((a,b)=>t[a]>t[b]?a:b); };
    const t1 = getWinner(state.user1.answers);
    const t2 = getWinner(state.user2.answers);
    const r1 = state.user1.role;
    const r2 = state.user2.role;
    const d1 = ROLES[r1].types[t1];
    const d2 = ROLES[r2].types[t2];
    const dest = DESTINATIONS[state.destination];

    show('stepResult'); fade('stepResult');
    el('mainTitle').innerHTML = "Your<br>Travel Sync."; el('mainDesc').classList.add('hidden');
    
    // Fill Personas
    el('p1Tag').textContent = r1; el('p1Type').textContent = d1.title; el('p1Desc').textContent = d1.desc; el('p1Img').src = d1.img;
    el('p2Tag').textContent = r2; el('p2Type').textContent = d2.title; el('p2Desc').textContent = d2.desc; el('p2Img').src = d2.img;

    // Build Timeline
    el('planCityName').textContent = dest.name;
    const tl = el('planTimeline'); tl.innerHTML = '';

    // Logic to pick a spot based on tag preference. If tag not found in city spots, default to 'view'
    const getSpot = (tag) => dest.spots[tag] || dest.spots.view;
    const spot1 = getSpot(d1.tag);
    const spot2 = getSpot(d2.tag);

    const events = [
      { t: "09:00 AM", title: "Morning Start", badge: "Shared", desc: "Start gently with a local breakfast near " + dest.spots.history + "." },
      { t: "11:00 AM", title: d1.title + "'s Pick", badge: r1, desc: d1.planText.replace("[SPOT]", `<b>${spot1}</b>`) },
      { t: "01:00 PM", title: "Lunch Break", badge: "Shared", desc: "Refuel at " + dest.spots.food + " – a spot that offers variety for both." },
      { t: "03:00 PM", title: d2.title + "'s Pick", badge: r2, desc: d2.planText.replace("[SPOT]", `<b>${spot2}</b>`) },
      { t: "06:00 PM", title: "Sunset & Dinner", badge: "Shared", desc: "Wind down with views at " + dest.spots.view + " followed by a relaxed dinner." }
    ];

    events.forEach(e => {
      const d = document.createElement('div'); d.className = 't-item';
      d.innerHTML = `<div class="t-dot"></div><div class="t-time">${e.t}</div><span class="t-badge">${e.badge}</span><div class="t-title">${e.title}</div><div class="t-desc">${e.desc}</div>`;
      tl.appendChild(d);
    });
  }
</script>
</body>
</html>